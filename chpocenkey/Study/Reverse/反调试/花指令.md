## 简介

花指令就是一串垃圾指令，它与程序本身的功能无关，并不影响程序本身的逻辑，但会影响反编译器的正常运行，干扰分析人员的静态分析，从而增加分析难度和分析时间

花指令也可以被用在病毒或木马上，通过加入花指令改变程序的特征码，躲避杀软的扫描，从而达到免杀的目的

## 分类

花指令一般分为两类

- 可执行花指令
- 不可执行花指令

### 可执行花指令

这类花指令会在程序运行的时候执行，但是执行这些指令没有任何意义，它并不会改变寄存器的值，同时反汇编器也可以正常地反汇编这些指令

可执行花指令的目的是为了增加静态分析的难度，从而加大逆向分析人员的工作量

### 不可执行花指令

这类花指令会使反编译器在反编译的时候出错，反汇编器可能错误的反汇编这些指令

根据反汇编的工作原理，只有花指令同正常指令的前几个字节被反汇编器识别成一组无用字节时，才能破坏反汇编的结果。因此，插入的花指令应当是一些不完整的指令

为了能确保代码正确运行的同时使反汇编出错，该类花指令必须满足两个基本条件

- 垃圾数据必须是某个合法指令的一部分
- 程序运行时，花指令必须位于实际不可执行的代码路径

## 原理

反汇编算法存在缺陷

反汇编算法主要可以分为两类

- 递归下降算法
- 线性扫描算法

### 1. 递归下降算法

递归下降算法强调控制流的概念

控制流根据一条指令是否被另一条指令引用来决定是否对其进行反汇编，遇到非控制转移指令时顺序进行反汇编，而遇到控制转移指令时则从转移地址处开始进行反汇编

通过构造必然条件或互补条件，可以使反汇编出错

IDA Pro 使用的就是递归下降算法

### 2. 线性扫描算法

线性扫描算法从程序入口点开始反汇编，然后对整个代码段进行扫描，反汇编扫描过程中所遇到的每条指令

在冯诺依曼体系下，线性扫描算法无法区分数据和代码，从而导致将代码段中嵌入的数据误解释为指令的操作码，以致最后得到错误的反汇编结果
