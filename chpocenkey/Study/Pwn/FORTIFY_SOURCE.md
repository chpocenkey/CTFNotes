## 简介
FORTIFY_SOURCE 是一个针对危险函数的检查机制，将危险函数替换为相对安全的函数实现，且不会对程序执行的性能产生大的影响

| 安全等级 | 结果                  |
| ---- | ------------------- |
| `0`  | 关闭                  |
| `1`  | 开启缓冲区溢出攻击检查         |
| `2`  | 开启缓冲区溢出以及格式化字符串攻击检查 |
## GCC 编译参数
| 参数                    | 安全等级 | 结果                  |
| --------------------- | ---- | ------------------- |
| `-D_FORTIFY_SOURCE=0` | `0`  | 关闭                  |
| `-D_FORTIFY_SOURCE=1` | `1`  | 开启缓冲区溢出攻击检查         |
| `-D_FORTIFY_SOURCE=2` | `2`  | 开启缓冲区溢出以及格式化字符串攻击检查 |
## 实现
### 缓冲区溢出的检查
1. 判断源数据的长度是否大于目的缓冲区的大小
	- 若是，调用 `__chk_fail()` 抛出异常
	- 若不是，调用普通函数 `memcpy()` 进行字符串复制操作
### 格式化字符串攻击的检查
- 针对 `%n` 格式字符串的，遇到试图利用 `%n` 写入拥有写权限的内存，就抛出异常
- 针对 `%N$` 这种带有位置参数的格式字符串的

## 安全性
利用漏洞将位于栈上的 `_IO_FILE` 结构中的 `_IO_FLAGS2_FORTIFY` 篡改为 `0`，从而关闭 FORTIFY_SOURCE 对 `%n` 的检查，再利用任意地址写，将 `nargs` 篡改为 `0`，从而关闭对 `%N$` 的检查